---
title: "Grafico3_JG"
author: "Jorge García"
date: "2024-03-05"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
# Asegúrate que el paquete "pacman" está instalado
if (!require("pacman")) install.packages("pacman")
```

```{r}
library(ggplot2)
library(readr)
library(tinytex)
library(dplyr)
```


```{r}
covid_data <- read_csv("https://covid.ourworldindata.org/data/owid-covid-data.csv")
spec(covid_data) # IMPORTAMOS CSV

spain <- which(covid_data$location == "Spain") #SACAMOS REGISTROS DE SPAIN
united_states <- which(covid_data$location == "United States") #... USA
italy <- which(covid_data$location == "Italy") #... ITALY
france <- which(covid_data$location == "France") #... FRANCE
germany <- which(covid_data$location == "Germany") #... GERMANY
japan <- which(covid_data$location == "Japan") #... JAPAN
canada <- which(covid_data$location == "Canada") #... CANADA
united_kingdom <-  which(covid_data$location == "United Kingdom") #... UK

paises <- c(canada, france, germany, italy, japan, spain, united_kingdom,
            united_states)
# Agrupamos todos los indices en un solo vector para poder sacarlos todos los 
#registros que nos interesan

covid_data_ref <- covid_data[paises, c(3,4,15)] %>% 
  subset( new_deaths_per_million > 0 )
#Recoge del data frame los valores que son mayores que 0 para que las lineas no
#desciendan directamente si no hay registros o el contel es 0.

#Nuevo dataframe con filas y columnas de interés
covid_data_ref_spain <- covid_data[spain, c(3,4,15)] %>%
  subset( new_deaths_per_million > 0 )

colores <- c("Canada" = "brown", "France" = "orange", "Germany" = "green", "Italy" = "cyan", "Japan" = "blue", "Spain" = "red", "United Kingdom" = "pink", "United States" = "purple")
```


```{r}
covid <- ggplot(data = covid_data_ref, aes(x = date, y = new_deaths_per_million/7,
                                  color = location)) +
  geom_line() + geom_line(data = covid_data_ref_spain, aes(x = date, 
  y = new_deaths_per_million/7),color = "red", linewidth = 0.7) + 
  labs(title = "Daily new confirmed COVID-19 deaths per million people", 
       subtitle = "For some countried the number pof confirmed deaths is much 
       lower than the true number of deaths, This is because of the limited 
       testing and challenges in the atribution of the cause of death",
       x = "Years", y = "New deaths per million") + 
  scale_color_manual(values = colores)
ggplotly(covid)
```